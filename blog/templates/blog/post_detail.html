{% extends 'blog/base.html' %}
{% block content %}
	<div class="post">
		{% if post.published_date %}
			<div class="date">
				{{ post.published_date }}
			</div>
		{% endif %}

		<h1>{{ post.title }}</h1>
		<p>{{ post.text|linebreaksbr }}</p>
	</div>
	<hr>

	{% for comment in comments_tree_page %}
		<div class="comment" style="margin-left:{{comment.nesting_index}}00px">
			<div class="date">{{ comment.created_date }}</div>
			<strong>{{ comment.author }}</strong>
			{% if comment.has_children %} {{ comment.children.count }} replies {% endif %}
			{% if user.is_authenticated %}
				<a href="{% url 'add_reply_to_post' pk=post.pk parent_pk=comment.pk%}" class="reply-btn">reply</a>
			{% endif%}

			<p>{{ comment.text |linebreaks }}</p>
		</div>
		<hr>

	{% empty %}
		<p>No comments here yet :(</p>
	{% endfor %}

	{% if comments_tree_page.paginator.count != 0 %}
		<nav aria-label="...">
		  <ul class="pagination">
		  	{% if comments_tree_page.has_previous %}
			    <li class="page-item">
		      		<a class="page-link" href="?page={{ comments_tree_page.previous_page_number }}" tabindex="-1">Previous</a>
			{% else %}
			    <li class="page-item disabled">
		      		<a class="page-link" href="#" tabindex="-1">Previous</a>
			{% endif %}
		    	</li>

			{% for page_number in comments_tree_page.paginator.page_range %}
				{% if page_number == comments_tree_page.number %}
				    <li class="page-item active"><a class="page-link" href="#">{{ page_number }}</a></li>
				{% else %}
				    <li class="page-item"><a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a></li>
				{% endif %}
			{% endfor %}

		  	{% if comments_tree_page.has_next %}
			    <li class="page-item">
		      		<a class="page-link" href="?page={{ comments_tree_page.next_page_number }}">Next</a>
			{% else %}
			    <li class="page-item disabled">
		      		<a class="page-link" href="#">Next</a>
			{% endif %}
		    	</li>
		  </ul>
		</nav>
	{% endif %}

	{% if user.is_authenticated %}
		<a class="btn btn-primary" href="{% url 'add_comment_to_post' pk=post.pk %}">Add comment</a>
	{% endif%}

{% endblock %}